import{_ as w,r as m,j as M,k as _,d as v,h as a,n as A,m as l,v as k,p as r,l as B,F as g,e as T,t as d,s as E,u as C,o as c,q as F}from"./index-Bm8gvO47.js";import{a as D}from"./api-B5pg7VfH.js";const N={class:"centered-form"},R={class:"form-container"},j={class:"mb-3"},L={class:"mb-3"},O={class:"mb-3"},z=["value"],G={class:"mb-3"},H={class:"mb-3"},J={class:"mb-3"},K=["value","data-price"],Q={class:"mb-3"},W=["value","id"],X=["for"],Y={class:"mb-3"},Z={id:"totalPrice2"},$={__name:"AppointmentEditPage",setup(h){const P=E(),I=C(),o=m({appointmentId:"",appointmentDate:"",appointmentTimeslot:"",appointmentTotal:0,appointmentStatus:0,paymentStatus:0}),i=m(""),s=m([]),f=[{id:1,name:"基礎洗澡",price:1e3},{id:2,name:"基礎洗護含美容修剪",price:2e3},{id:3,name:"專業洗護",price:1900},{id:4,name:"專業洗護含美容修剪",price:2800}],b=[{id:1,name:"7公斤以上",price:100},{id:2,name:"防蚤洗劑",price:300},{id:3,name:"貓咪草本洗毛精",price:350},{id:4,name:"狗狗草本洗毛精",price:350}],u=M(()=>{var e;const n=((e=f.find(p=>p.id===parseInt(i.value)))==null?void 0:e.price)||0,t=s.value.reduce((p,V)=>{const S=b.find(q=>q.id===V);return p+(S?S.price:0)},0);return n+t});function y(){o.value.appointmentTotal=u.value}async function x(){const n=P.params.id,e=(await D.showUpdatePage(n)).data;console.log("更新資料:",e),o.value={...e,appointmentId:e.appointmentId,appointmentDate:e.appointmentDate,appointmentTimeslot:e.appointmentTimeslot,appointmentStatus:e.appointmentStatus,paymentStatus:e.paymentStatus,appointmentTotal:e.appointmentTotal},i.value=e.itemId,s.value=e.extraPackageIds||[]}async function U(){const n=new FormData;n.append("appointmentStatus",o.value.appointmentStatus),n.append("paymentStatus",o.value.paymentStatus),n.append("appointmentDate",o.value.appointmentDate),n.append("appointmentTimeslot",o.value.appointmentTimeslot),i.value&&n.append("services",i.value),s.value&&s.value.length>0&&s.value.forEach(t=>{n.append("extraPackages",t)});try{await D.updateAppointmentById(o.value.appointmentId,n),alert("預約更新成功"),I.push("/")}catch(t){alert("更新失敗，請稍後再試"),console.error(t)}}return _(x),(n,t)=>(c(),v("div",N,[a("div",R,[a("form",{onSubmit:A(U,["prevent"])},[l(a("input",{type:"hidden","onUpdate:modelValue":t[0]||(t[0]=e=>o.value.appointmentId=e)},null,512),[[k,o.value.appointmentId]]),a("div",j,[t[7]||(t[7]=a("label",{for:"appointmentDate",class:"form-label"},"預約日期:",-1)),l(a("input",{type:"date",id:"appointmentDate",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=e=>o.value.appointmentDate=e),required:""},null,512),[[k,o.value.appointmentDate]])]),a("div",L,[t[9]||(t[9]=a("label",{for:"appointmentTimeslot",class:"form-label"},"預約時段:",-1)),l(a("select",{id:"appointmentTimeslot",class:"form-select","onUpdate:modelValue":t[2]||(t[2]=e=>o.value.appointmentTimeslot=e),required:""},t[8]||(t[8]=[B('<option value="10:00-12:00" data-v-bbe7f3a1>10:00-12:00</option><option value="12:00-14:00" data-v-bbe7f3a1>12:00-14:00</option><option value="14:00-16:00" data-v-bbe7f3a1>14:00-16:00</option><option value="16:00-18:00" data-v-bbe7f3a1>16:00-18:00</option><option value="18:00-20:00" data-v-bbe7f3a1>18:00-20:00</option>',5)]),512),[[r,o.value.appointmentTimeslot]])]),a("div",O,[t[10]||(t[10]=a("label",{for:"totalPrice",class:"form-label"},"總價格:",-1)),a("input",{type:"number",class:"form-control",id:"totalPrice",value:u.value,readonly:""},null,8,z)]),a("div",G,[t[12]||(t[12]=a("label",{class:"form-label"},"預約狀態:",-1)),l(a("select",{class:"form-select","onUpdate:modelValue":t[3]||(t[3]=e=>o.value.appointmentStatus=e),required:""},t[11]||(t[11]=[a("option",{value:"0"},"未完成",-1),a("option",{value:"1"},"已完成",-1),a("option",{value:"2"},"已取消",-1)]),512),[[r,o.value.appointmentStatus]])]),a("div",H,[t[14]||(t[14]=a("label",{class:"form-label"},"付款狀態:",-1)),l(a("select",{class:"form-select","onUpdate:modelValue":t[4]||(t[4]=e=>o.value.paymentStatus=e),required:""},t[13]||(t[13]=[a("option",{value:"0"},"未付款",-1),a("option",{value:"1"},"已付款",-1)]),512),[[r,o.value.paymentStatus]])]),a("div",J,[t[16]||(t[16]=a("label",{class:"form-label"},"選擇服務:",-1)),l(a("select",{class:"form-select","onUpdate:modelValue":t[5]||(t[5]=e=>i.value=e),onChange:y,required:""},[t[15]||(t[15]=a("option",{disabled:"",value:""},"請選擇服務",-1)),(c(),v(g,null,T(f,e=>a("option",{key:e.id,value:e.id,"data-price":e.price},d(e.name)+" +"+d(e.price)+"元 ",9,K)),64))],544),[[r,i.value]])]),a("div",Q,[t[17]||(t[17]=a("label",{class:"form-label"},"額外加購:",-1)),(c(),v(g,null,T(b,e=>a("div",{key:e.id,class:"form-check"},[l(a("input",{class:"form-check-input",type:"checkbox",value:e.id,"onUpdate:modelValue":t[6]||(t[6]=p=>s.value=p),onChange:y,id:"package-"+e.id},null,40,W),[[F,s.value]]),a("label",{class:"form-check-label",for:"package-"+e.id},d(e.name)+" +"+d(e.price)+"元 ",9,X)])),64))]),a("div",Y,[a("div",Z,"總價: "+d(u.value)+" 元",1)]),t[18]||(t[18]=a("button",{type:"submit",class:"btn btn-primary"},"更新預約",-1))],32)])]))}},at=w($,[["__scopeId","data-v-bbe7f3a1"]]);export{at as default};
