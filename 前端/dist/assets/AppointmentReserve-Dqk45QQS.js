import{_ as M,j as P,s as N,r as m,i as S,k as V,d as n,h as a,m as v,p as I,F as p,e as b,v as U,t as u,n as R,u as A,o as r,q as C}from"./index-Bm8gvO47.js";import{a as g}from"./api-B5pg7VfH.js";const F={class:"container py-5"},j={class:"mb-3"},E=["disabled"],Q=["value"],J={class:"mb-3"},L={class:"mb-3"},O=["disabled"],z=["value","disabled"],G={class:"mb-3"},H=["value"],K={class:"mb-3"},W=["value","id"],X=["for"],Y={class:"mb-3"},Z={class:"text-success"},$={__name:"AppointmentReserve",setup(ee){const h=A(),T=N();P(()=>T.query.service||"");const i=m([]),f=m([]),x=m([{id:1,name:"åŸºç¤æ´—æ¾¡",price:1e3},{id:2,name:"åŸºç¤æ´—è­·å«ç¾å®¹ä¿®å‰ª",price:2e3},{id:3,name:"å°ˆæ¥­æ´—è­·",price:1900},{id:4,name:"å°ˆæ¥­æ´—è­·å«ç¾å®¹ä¿®å‰ª",price:2800}]),y=m([{id:1,name:"7å…¬æ–¤ä»¥ä¸Š",price:100},{id:2,name:"é˜²èš¤æ´—åŠ‘",price:300},{id:3,name:"è²“å’ªè‰æœ¬æ´—æ¯›ç²¾",price:350},{id:4,name:"ç‹—ç‹—è‰æœ¬æ´—æ¯›ç²¾",price:350}]),k=P(()=>{let l=0;const e=x.value.find(t=>t.id===s.value.service);e&&(l+=e.price);for(const t of s.value.extraPackages){const o=y.value.find(c=>c.id===t);o&&(l+=o.price)}return l}),s=m({memberId:2,petId:"",date:"",timeslot:"",service:"",extraPackages:[]}),_=async()=>{const l=s.value.memberId;if(!l){i.value=[];return}try{const e=await g.handleQueryPetById(l);i.value=e.data,console.log("âœ… æˆåŠŸè¼‰å…¥å¯µç‰©è³‡æ–™:",i.value)}catch(e){console.error("âŒ è¼‰å…¥å¯µç‰©è³‡æ–™å¤±æ•—",e)}};S(()=>s.value.memberId,l=>{l?_():i.value=[]});const D=async()=>{const l=s.value.date;if(!l){alert("è«‹é¸æ“‡ä¸€å€‹æ—¥æœŸ");return}try{const t=(await g.handleQueryBookingTime(l)).data.bookedTimeslots||[],o=["10:00-12:00","12:00-14:00","14:00-16:00","16:00-18:00","18:00-20:00"];f.value=o.map(c=>({slot:c,disabled:t.includes(c)}))}catch(e){console.error("ç„¡æ³•ç²å–é ç´„è³‡æ–™: ",e)}},q=async()=>{var e,t;console.log("è¡¨å–®è³‡æ–™:",s.value);const l={memberId:parseInt(s.value.memberId,10),petId:parseInt(s.value.petId,10),appointmentDate:s.value.date,appointmentTimeslot:s.value.timeslot,services:s.value.service,extraPackages:s.value.extraPackages};console.log("é€å‡ºè³‡æ–™:",JSON.stringify(l));try{const o=await g.addAppointment(l);console.log("é ç´„æˆåŠŸ",o.data);const c=((e=i.value.find(d=>d.petId===parseInt(s.value.petId)))==null?void 0:e.petName)||"",w=((t=x.value.find(d=>d.id===s.value.service))==null?void 0:t.name)||"",B=y.value.filter(d=>s.value.extraPackages.includes(d.id)).map(d=>d.name);h.push({path:"/toappointments/hendlereserve",query:{id:o.data.appointmentId,pet:c,date:s.value.date,timeslot:s.value.timeslot,service:w,extras:B.join(","),total:k.value}})}catch(o){console.error("é ç´„å¤±æ•—",o)}};return V(()=>{_()}),(l,e)=>(r(),n("div",F,[e[14]||(e[14]=a("h2",{class:"mb-4 text-success text-center"},"ğŸ¾ é ç´„ç¾å®¹æœå‹™",-1)),a("form",{onSubmit:R(q,["prevent"]),class:"border rounded p-4 shadow-sm bg-light-subtle"},[a("div",j,[e[6]||(e[6]=a("label",{class:"form-label"},"å¯µç‰©",-1)),v(a("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>s.value.petId=t),class:"form-select",disabled:i.value.length===0,required:""},[e[5]||(e[5]=a("option",{value:"",disabled:""},"è«‹é¸æ“‡å¯µç‰©",-1)),(r(!0),n(p,null,b(i.value,t=>(r(),n("option",{key:t.petId,value:t.petId},u(t.petName),9,Q))),128))],8,E),[[I,s.value.petId]])]),a("div",J,[e[7]||(e[7]=a("label",{class:"form-label",for:"appointmentDate"},"é ç´„æ—¥æœŸ",-1)),v(a("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=t=>s.value.date=t),id:"appointmentDate",class:"form-control",onChange:D,required:""},null,544),[[U,s.value.date]])]),a("div",L,[e[9]||(e[9]=a("label",{class:"form-label",for:"appointmentTimeslot"},"é ç´„æ™‚æ®µ",-1)),v(a("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>s.value.timeslot=t),id:"appointmentTimeslot",class:"form-select",disabled:!f.value.length,required:""},[e[8]||(e[8]=a("option",{value:"",disabled:"",selected:""},"è«‹é¸æ“‡æ™‚æ®µ",-1)),(r(!0),n(p,null,b(f.value,(t,o)=>(r(),n("option",{key:o,value:t.slot,disabled:t.disabled},u(t.slot),9,z))),128))],8,O),[[I,s.value.timeslot]])]),a("div",G,[e[11]||(e[11]=a("label",{class:"form-label"},"é¸æ“‡æœå‹™",-1)),v(a("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>s.value.service=t),class:"form-select",required:""},[e[10]||(e[10]=a("option",{value:"",disabled:""},"è«‹é¸æ“‡æœå‹™",-1)),(r(!0),n(p,null,b(x.value,t=>(r(),n("option",{value:t.id,key:t.id},u(t.name)+" +"+u(t.price)+"å…ƒ ",9,H))),128))],512),[[I,s.value.service]])]),a("div",K,[e[12]||(e[12]=a("label",{class:"form-label"},"é¡å¤–åŠ è³¼",-1)),(r(!0),n(p,null,b(y.value,t=>(r(),n("div",{key:t.id,class:"form-check"},[v(a("input",{class:"form-check-input",type:"checkbox",value:t.id,"onUpdate:modelValue":e[4]||(e[4]=o=>s.value.extraPackages=o),id:"extra"+t.id},null,8,W),[[C,s.value.extraPackages]]),a("label",{class:"form-check-label",for:"extra"+t.id},u(t.name)+" +"+u(t.price)+"å…ƒ ",9,X)]))),128))]),a("div",Y,[a("strong",Z,"ç¸½åƒ¹: "+u(k.value)+" å…ƒ",1)]),e[13]||(e[13]=a("div",{class:"text-end"},[a("button",{type:"submit",class:"btn btn-green"},"ğŸ¶ é€å‡ºé ç´„")],-1))],32)]))}},ae=M($,[["__scopeId","data-v-ddd678b3"]]);export{ae as default};
