import{_ as O,r as u,k as X,j as V,d as c,h as e,b as l,m as Y,p as Z,w as r,a as d,F as h,e as tt,t as a,f as o,s as et,o as p,g as M,x as nt}from"./index-Bm8gvO47.js";import{a as P}from"./api-B5pg7VfH.js";import{Q as st}from"./QrCodeDisplay-C8cDXJOn.js";const ot={class:"container mt-5"},lt={class:"row align-items-end mb-3"},at={class:"col-md-6"},rt={class:"col-md-6 text-end"},ut={key:0,class:"alert alert-warning text-center"},dt={key:1},it={class:"d-flex justify-content-between align-items-start mb-2"},ct={class:"fw-bold"},pt={class:"text-muted"},mt={key:0,class:"d-flex align-items-center gap-2"},vt=["onClick"],gt={key:1,class:"mt-3"},_t={class:"d-flex justify-content-center mt-4"},ft=["disabled"],bt={class:"mx-3"},yt=["disabled"],x=3,Ct={__name:"AppointmentQueryPage",props:{appointmentId:Number},emits:["appointmentCancelled"],setup(kt,{emit:A}){et();const Q=n=>{m.value===n?m.value=null:m.value=n},w=u(),f=u(0),_=u([]),i=u(1),m=u(null),S=async()=>{try{const n=await P.getAppointmentsByStatus(w.value,f.value);_.value=n.data}catch(n){console.error("獲取預約資料失敗",n),alert(`無法加載預約資料，錯誤訊息: ${n.message}`)}},D=n=>{if(!n)return"無服務項";const t=n.split(/[\s,]+/).map(g=>g.trim()).filter(g=>g.length>0);return[...new Set(t)].join(", ")},b=u(!1),y=u(""),v=u(!1),C=u(null),N=n=>{C.value=n,v.value=!0},R=async()=>{try{const n=await P.AppointmentCancel(C.value);y.value=n.data,v.value=!1,b.value=!0,$("appointmentCancelled",C.value),window.location.reload()}catch{y.value="取消預約失敗，請稍後再試"}},$=A;X(()=>{const n=localStorage.getItem("memberId");n?(w.value=n,S()):alert("尚未登入，請先登入會員")});const j=n=>({0:"待處理",1:"已完成",2:"已取消"})[n]||"未知狀態",B=n=>({0:"未支付",1:"已支付"})[n]||"未知支付狀態",T=n=>{if(!n)return"未提供日期";const t={year:"numeric",month:"long",day:"numeric"};return new Date(n).toLocaleDateString("zh-TW",t)},F=V(()=>{const n=(i.value-1)*x,t=n+x;return _.value.slice(n,t)}),I=V(()=>Math.ceil(_.value.length/x)),U=()=>{i.value<I.value&&i.value++},q=()=>{i.value>1&&i.value--};return(n,t)=>{const g=d("router-link"),k=d("v-btn"),z=d("v-card-title"),L=d("v-card-text"),E=d("v-spacer"),W=d("v-card-actions"),G=d("v-card"),H=d("v-dialog"),J=d("v-snackbar");return p(),c("div",ot,[t[19]||(t[19]=e("h2",{class:"text-center mb-4"},"預約訂單查詢",-1)),e("div",lt,[e("div",at,[t[5]||(t[5]=e("label",{for:"statusSelect",class:"form-label"},"選擇預約狀態：",-1)),Y(e("select",{id:"statusSelect","onUpdate:modelValue":t[0]||(t[0]=s=>f.value=s),onChange:S,class:"form-select"},t[4]||(t[4]=[e("option",{value:0},"待處理",-1),e("option",{value:1},"已完成",-1),e("option",{value:2},"已取消",-1)]),544),[[Z,f.value]])]),e("div",rt,[l(g,{to:"/toappointments",class:"btn btn-success mt-3"},{default:r(()=>t[6]||(t[6]=[o("回首頁")])),_:1})])]),_.value.length===0?(p(),c("div",ut," 尚未找到任何預約。 ")):(p(),c("ul",dt,[(p(!0),c(h,null,tt(F.value,s=>(p(),c("li",{key:s.appointmentId,class:"mb-4 p-3 border rounded shadow-sm"},[e("div",it,[e("p",ct,"預約編號: "+a(s.appointmentId),1),e("p",pt,a(j(s.appointmentStatus)),1)]),e("div",null,[e("p",null,[t[7]||(t[7]=e("strong",null,"寵物名稱:",-1)),o(" "+a(s.petName||"無提供寵物名稱"),1)]),e("p",null,[t[8]||(t[8]=e("strong",null,"預約日期:",-1)),o(" "+a(T(s.appointmentDate)),1)]),e("p",null,[t[9]||(t[9]=e("strong",null,"時段:",-1)),o(" "+a(s.appointmentTimeslot||"無提供時段"),1)]),e("p",null,[t[10]||(t[10]=e("strong",null,"基本服務:",-1)),o(" "+a(D(s.serviceNames)||"無服務項"),1)]),e("p",null,[t[11]||(t[11]=e("strong",null,"加購服務:",-1)),o(" "+a(s.additionalPackages||"無加購服務"),1)]),e("p",null,[t[12]||(t[12]=e("strong",null,"總費用:",-1)),o(" $"+a(s.appointmentTotal||"未提供費用"),1)]),e("p",null,[t[13]||(t[13]=e("strong",null,"支付狀態:",-1)),o(" "+a(B(s.paymentStatus)),1)])]),s.appointmentStatus===0?(p(),c("div",mt,[e("button",{class:nt(["btn",m.value===s.appointmentId?"btn-danger":"btn-success"]),onClick:K=>Q(s.appointmentId)},a(m.value===s.appointmentId?"關閉 QR Code":"顯示 QR Code"),11,vt),l(k,{variant:"outlined",color:"error",class:"custom-cancel-btn",onClick:K=>N(s.appointmentId)},{default:r(()=>t[14]||(t[14]=[o(" 取消預約 ")])),_:2},1032,["onClick"])])):M("",!0),m.value===s.appointmentId&&s.appointmentStatus===0?(p(),c("div",gt,[l(st,{"appointment-id":s.appointmentId},null,8,["appointment-id"])])):M("",!0)]))),128))])),e("div",_t,[e("button",{class:"btn btn-secondary",onClick:q,disabled:i.value===1}," 上一頁 ",8,ft),e("span",bt,"第 "+a(i.value)+" 頁",1),e("button",{class:"btn btn-secondary",onClick:U,disabled:i.value===I.value}," 下一頁 ",8,yt)]),t[20]||(t[20]=e("div",{class:"text-center text-muted mt-5"},[e("p",null,[o(" 店家地址： "),e("a",{href:"https://www.google.com/maps?q=桃園市中壢區新生路二段421號",target:"_blank",rel:"noopener noreferrer",class:"text-body text-decoration-none"}," 桃園市中壢區新生路二段421號 ")]),e("p",null,"電話：(03) 453-3013 ")],-1)),l(H,{modelValue:v.value,"onUpdate:modelValue":t[2]||(t[2]=s=>v.value=s),"max-width":"400"},{default:r(()=>[l(G,null,{default:r(()=>[l(z,{class:"text-h6"},{default:r(()=>t[15]||(t[15]=[o("確認取消預約")])),_:1}),l(L,null,{default:r(()=>t[16]||(t[16]=[o("您確定要取消此預約嗎？")])),_:1}),l(W,null,{default:r(()=>[l(E),l(k,{color:"secondary",onClick:t[1]||(t[1]=s=>v.value=!1)},{default:r(()=>t[17]||(t[17]=[o("返回")])),_:1}),l(k,{color:"error",onClick:R,class:"no-hover-green",style:{"box-shadow":"none"}},{default:r(()=>t[18]||(t[18]=[o("確認取消預約")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(J,{modelValue:b.value,"onUpdate:modelValue":t[3]||(t[3]=s=>b.value=s),timeout:3e3,color:"success",top:""},{default:r(()=>[o(a(y.value),1)]),_:1},8,["modelValue"])])}}},It=O(Ct,[["__scopeId","data-v-53c3624d"]]);export{It as default};
