import{_ as M,j as P,s as N,r as m,i as S,k as V,d as n,h as a,m as v,p as I,F as p,e as b,v as U,t as u,n as R,u as A,o as r,q as C}from"./index-Bm8gvO47.js";import{a as g}from"./api-B5pg7VfH.js";const F={class:"container py-5"},j={class:"mb-3"},E=["disabled"],Q=["value"],J={class:"mb-3"},L={class:"mb-3"},O=["disabled"],z=["value","disabled"],G={class:"mb-3"},H=["value"],K={class:"mb-3"},W=["value","id"],X=["for"],Y={class:"mb-3"},Z={class:"text-success"},$={__name:"AppointmentReserve",setup(ee){const h=A(),T=N();P(()=>T.query.service||"");const i=m([]),f=m([]),x=m([{id:1,name:"基礎洗澡",price:1e3},{id:2,name:"基礎洗護含美容修剪",price:2e3},{id:3,name:"專業洗護",price:1900},{id:4,name:"專業洗護含美容修剪",price:2800}]),y=m([{id:1,name:"7公斤以上",price:100},{id:2,name:"防蚤洗劑",price:300},{id:3,name:"貓咪草本洗毛精",price:350},{id:4,name:"狗狗草本洗毛精",price:350}]),k=P(()=>{let l=0;const e=x.value.find(t=>t.id===s.value.service);e&&(l+=e.price);for(const t of s.value.extraPackages){const o=y.value.find(c=>c.id===t);o&&(l+=o.price)}return l}),s=m({memberId:2,petId:"",date:"",timeslot:"",service:"",extraPackages:[]}),_=async()=>{const l=s.value.memberId;if(!l){i.value=[];return}try{const e=await g.handleQueryPetById(l);i.value=e.data,console.log("✅ 成功載入寵物資料:",i.value)}catch(e){console.error("❌ 載入寵物資料失敗",e)}};S(()=>s.value.memberId,l=>{l?_():i.value=[]});const D=async()=>{const l=s.value.date;if(!l){alert("請選擇一個日期");return}try{const t=(await g.handleQueryBookingTime(l)).data.bookedTimeslots||[],o=["10:00-12:00","12:00-14:00","14:00-16:00","16:00-18:00","18:00-20:00"];f.value=o.map(c=>({slot:c,disabled:t.includes(c)}))}catch(e){console.error("無法獲取預約資料: ",e)}},q=async()=>{var e,t;console.log("表單資料:",s.value);const l={memberId:parseInt(s.value.memberId,10),petId:parseInt(s.value.petId,10),appointmentDate:s.value.date,appointmentTimeslot:s.value.timeslot,services:s.value.service,extraPackages:s.value.extraPackages};console.log("送出資料:",JSON.stringify(l));try{const o=await g.addAppointment(l);console.log("預約成功",o.data);const c=((e=i.value.find(d=>d.petId===parseInt(s.value.petId)))==null?void 0:e.petName)||"",w=((t=x.value.find(d=>d.id===s.value.service))==null?void 0:t.name)||"",B=y.value.filter(d=>s.value.extraPackages.includes(d.id)).map(d=>d.name);h.push({path:"/toappointments/hendlereserve",query:{id:o.data.appointmentId,pet:c,date:s.value.date,timeslot:s.value.timeslot,service:w,extras:B.join(","),total:k.value}})}catch(o){console.error("預約失敗",o)}};return V(()=>{_()}),(l,e)=>(r(),n("div",F,[e[14]||(e[14]=a("h2",{class:"mb-4 text-success text-center"},"🐾 預約美容服務",-1)),a("form",{onSubmit:R(q,["prevent"]),class:"border rounded p-4 shadow-sm bg-light-subtle"},[a("div",j,[e[6]||(e[6]=a("label",{class:"form-label"},"寵物",-1)),v(a("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>s.value.petId=t),class:"form-select",disabled:i.value.length===0,required:""},[e[5]||(e[5]=a("option",{value:"",disabled:""},"請選擇寵物",-1)),(r(!0),n(p,null,b(i.value,t=>(r(),n("option",{key:t.petId,value:t.petId},u(t.petName),9,Q))),128))],8,E),[[I,s.value.petId]])]),a("div",J,[e[7]||(e[7]=a("label",{class:"form-label",for:"appointmentDate"},"預約日期",-1)),v(a("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=t=>s.value.date=t),id:"appointmentDate",class:"form-control",onChange:D,required:""},null,544),[[U,s.value.date]])]),a("div",L,[e[9]||(e[9]=a("label",{class:"form-label",for:"appointmentTimeslot"},"預約時段",-1)),v(a("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>s.value.timeslot=t),id:"appointmentTimeslot",class:"form-select",disabled:!f.value.length,required:""},[e[8]||(e[8]=a("option",{value:"",disabled:"",selected:""},"請選擇時段",-1)),(r(!0),n(p,null,b(f.value,(t,o)=>(r(),n("option",{key:o,value:t.slot,disabled:t.disabled},u(t.slot),9,z))),128))],8,O),[[I,s.value.timeslot]])]),a("div",G,[e[11]||(e[11]=a("label",{class:"form-label"},"選擇服務",-1)),v(a("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>s.value.service=t),class:"form-select",required:""},[e[10]||(e[10]=a("option",{value:"",disabled:""},"請選擇服務",-1)),(r(!0),n(p,null,b(x.value,t=>(r(),n("option",{value:t.id,key:t.id},u(t.name)+" +"+u(t.price)+"元 ",9,H))),128))],512),[[I,s.value.service]])]),a("div",K,[e[12]||(e[12]=a("label",{class:"form-label"},"額外加購",-1)),(r(!0),n(p,null,b(y.value,t=>(r(),n("div",{key:t.id,class:"form-check"},[v(a("input",{class:"form-check-input",type:"checkbox",value:t.id,"onUpdate:modelValue":e[4]||(e[4]=o=>s.value.extraPackages=o),id:"extra"+t.id},null,8,W),[[C,s.value.extraPackages]]),a("label",{class:"form-check-label",for:"extra"+t.id},u(t.name)+" +"+u(t.price)+"元 ",9,X)]))),128))]),a("div",Y,[a("strong",Z,"總價: "+u(k.value)+" 元",1)]),e[13]||(e[13]=a("div",{class:"text-end"},[a("button",{type:"submit",class:"btn btn-green"},"🐶 送出預約")],-1))],32)]))}},ae=M($,[["__scopeId","data-v-ddd678b3"]]);export{ae as default};
